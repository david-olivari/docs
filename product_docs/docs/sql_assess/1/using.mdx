---
title: Using EDB SQL Assess
navTitle: Using
---

EDB SQL Assess is a Java-based command line tool that the end user can download and install on their test setup where they can put Oracle in trace mode and run the application. The end user can run a test program or regression test suite that performs most of the possible user actions so that all queries get captured in the trace file. The tool doesn't provide the ability to help put Oracle in trace mode or automatically retrieve the trace file.  The generation and retrieval of the trace file from the server (if different than the machine where the tool is being run) are separate operations performed manually by the user.

## Generating a SQL trace file

The EDB SQL Assess utility provides the ability to parse Oracle trace files to identify the SQL statements that were executed during an application database session. Once identified, it can assess those statements for their compatibility with EDB Postgres Advanced Server.

To generate the trace file for an application, perform the following steps:

1. Start the application and let the application connect to the Oracle database server. 

   For the remaining steps, assume that the Oracle user used by the application in the examples is RS4_LIN32.

2. Connect to the Oracle database using SQL*Plus, SQL Developer, or another Oracle client as a user with privileges. With the privileged user, query the `SYS.V$SESSION` and `SYS.V$PROCESS` synonyms and underlying `SYS.V_$SESSION` and `V_$PROCESS` tables and execute the `DBMS_SYSTEM.SET_SQL_TRACE_IN_SESSION` procedure to initiate a trace.

3. In the Oracle client (for example, SQL*Plus), execute the following query to retrieve the session Id (SID) and serial number for the application connection:

   ```SQL
   SELECT sid, serial#, substr(username, 1, 10), process FROM sys.v_$session WHERE username = 'RS4_LIN32';
   __OUTPUT__

    SID   SERIAL#   SUBSTR(USERNAME,1,10)    PROCESS
   ---- ---------- ------------------------ --------
	16	   6590     RS4_LIN32                35835
   ```
   !!! Tip
      Note the `SID` and `SERIAL#` returned by the query.

4. In the Oracle client, execute the following statement to start a trace:
   
   ```SQL
   EXECUTE dbms_system.set_sql_trace_in_session(16, 6590, true);
   ```

     This statement enables SQL tracing for the session initiated by the application.

   !!! Note
     Depending on the applicationsâ€™ database activity, the trace files may become large and could impact database resource usage and performance.  In operational environments especially, it is recommended that a trace be run for only the amount of time required to collect the necessary application queries.  For more information about the Oracle SQL Trace Facility and related guidelines on performing application tracing, visit the [Oracle documentation](https://docs.oracle.com/en/database/oracle/oracle-database/19/tgsql/performing-application-tracing.html#GUID-440D3AD4-B302-408E-8627-FE8032DD09F9).  
   !!!

      Instructions for stopping the trace are provided in the last step of this procedure.


5. Run use cases of the application or run the regression test suite for the application so that the application generates most of the SQL statements.  

6. In the Oracle client, execute the following query to retrieve the `SPID`, which can be used to identify the trace file generated for the application session:

   ```SQL
   SELECT a.sid, a.serial#, substr(a.username, 1, 10) usr, substr(a.osuser,1,5) osusr, b.spid FROM v$session a, v$process b WHERE a.paddr= b.addr and a.sid=16;
   __OUTPUT__
    SID  SERIAL#    USR               OSUSR       SPID
   ---- ---------- ---------------- ------------ --------
    16   6590       RS4_LIN32        abbas        122523
   ```

   !!! Tip
     Note the `SPID` returned by the query.


7. In the Oracle client, execute the following query to find the location of the trace file:

   ```SQL
   SELECT physical_path||'/'||physical_file trace_file FROM x$dbgdirext where physical_file like '%\_122523.trc' ESCAPE '\';
   __OUTPUT__
   TRACE_FILE
   ------------------------------------------------------------------------
   /u01/app/Oracle/diag/diag/rdbms/orcl/ORCL/trace/ORCL_ora_122523.trc
   ```

     When running the above query in your environment, replace `122523` with the `SPID` value returned by the query executed in the previous step.

  !!! Note
     Oracle introduced the `V$DIAG_TRACE_FILE` view in Oracle 12c Release 2 that can be queried instead of the `X$DBGDIREXT` table. The following query could be used to retrieve the trace file information from the view:
     
     ```SQL
     SELECT adr_home||'/'||trace_filename FROM V$DIAG_TRACE_FILE WHERE trace_filename LIKE '%\_43445.trc' ESCAPE '\';
     ```

     In both queries, a forward slash `/` is concatenated onto the trace directory path, which would be correct for Linux based systems. For Windows, however, the forward slash should be replaced with a backward slash `\`.

8. Find the trace file returned by the query in the previous step on the database server host machine: 

     In this example, the following is the full path to the file to locate:

   ```text
   /u01/app/Oracle/diag/diag/rdbms/orcl/ORCL/trace/ORCL_ora_122523.trc
   ```

9. Copy the trace file and share it with the migration assessment team.

10. In the Oracle client, execute the following statement to stop tracing of the application session:

   ```SQL
   EXECUTE dbms_system.set_sql_trace_in_session(16, 6590, false);
   ```

## Using the Query extractor

Query extractor is a SQL script that can be run on SQL*Plus prompt to extract queries run by the user application from the `V$SQL` system table. The query extractor script expects four input parameters:

1. Location for output file &mdash; Provide the path where you want the query extractor to place the SQL statements extracted from the `V$SQL` table.

1. The name of the user whose queries are to be extracted &mdash; The script extracts the SQL statements run only by the provided Oracle user.

1. The start timestamp of the queries &mdash; Provide the starting timestamp of the queries to extract in the format DD-MM-YYYY HH24:MI:SS.

1. The end timestamp of the queries &mdash; Provide the ending timestamp of the queries to extract in the format DD-MM-YYYY HH24:MI:SS.

For example:

    ```text
    SQL>@edb_queries_extractor.sql
    Location for output file : /tmp/
    Enter the name of the user whose queries are to be extracted: rs0_lin32
    Enter the start timestamp of the queries (DD-MM-YYYY HH24:MI:SS): 04-12-2022 10:00:00
    Enter the end timestamp of the queries (DD-MM-YYYY HH24:MI:SS): 04-12-2022 11:00:00
    ```

## Performing a SQL assessment

After generating the trace files using either the Oracle trace file or the Query extractor, the user can run the assessSQL.jar file to generate a report. The report helps the user to modify the SQL statements in the application for porting the application to EDB Postgres Advanced Server. The tool also generates SQL output files. The queries in these output files might be modified to be compatible with EDB Postgres Advanced Server syntax. The generated SQL output files and the report contains the query syntax that is compatible with JDBC.

### Command options

```shell
java -jar assessSQL.jar -help
usage: assessSQL <options>
 -appname <name>             Specify the name of the application
 -help                       Print all available options
 -includeUIDs <userIDs>      Specify comma separated list of User IDs for
                             assessment consideration
 -inputfilepath <path>       Specify the path containing the input file/s
 -inputfiletype <filetype>   Specify either trace, exported or plain
 -loglevel <level>           Specify logging level e.g. OFF, INFO, FINE
 -reportpath <path>          Specify the path where report will be saved
 -sourcedb <version>         Specify source database e.g. Oracle_19c
 -targetdb <version>         Specify target database e.g. EPAS_14
 -version                    Print the version information and exit

java -jar assessSQL.jar -version
AssessSQL ver 1.0

java -jar assessSQL.jar -appname TeleApp -inputfilepath /home/abbas/Projects/MigSQL/trc4/ -inputfiletype trace -reportpath /home/abbas/Projects/MigSQL/rep4/ -loglevel FINE -sourcedb ORACLE_19C -targetdb EPAS_14 -includeUIDs 1494
AssessSQL ver 1.0
Input file type: TRACE
Input file path: /home/abbas/Projects/MigSQL/trc4/
Report path: /home/abbas/Projects/MigSQL/rep4/
Application Name: TeleApp
Source Database: ORACLE_19C
Target Database: EPAS_14
Logging Level: FINE
Processing File: orcl_ora_61964.trc...
Generating Report....
Connected to H2 ..
**********************
Generating report ....
**********************
Report generation complete.
```

### `includeUIDs` parameter

The `includeUIDs` parameter can filter queries from trace files with comma separated Oracle UID values, like `106, 1120`. For example, if a user provides the value `106`, then the queries associated with only UID 106 are assessed and all other queries are discarded. If a user doesn't provide a value for this parameter, by default EDB SQL Assess filters queries for `UID=0` and all other queries are assessed. 

To view the UID of an Oracle user, run the following command after connecting as the user: 

```sql
SELECT UID FROM DUAL;
```

### `inputfiletype` parameter

EDB SQL Assess beta version 1 supports only `trace`. The `exported` and `plain` types will be available for future use. 

## Reviewing EDB SQL Assess reports

EDB SQL Assess divides the features used by application queries into four categories:

1. **Compatible features** &mdash; Provides the count of compatible features used in queries.

1. **Features with existing available workaround** &mdash; Provides the count of features with known and practical workarounds used in queries.

1. **Features with reasonable effort new workaround** &mdash; Provides the count of features where no practical in-database workaround is available and that may require a change in the application architecture.

1. **Features with no workaround or requiring further investigation** &mdash; Provides the count of incompatible features for which further investigation is required.

The generated report contains the following tables:

1. Overall feature compatibility summary

1. Compatibility summary for each input file

1. Incompatible features for each input file &mdash; Contains a list of incompatible features used by queries in the input file. Also provides the query ID of the query that uses this incompatible feature.

1. Incompatible queries for each input file &mdash; Contains a list of all incompatible queries along with the incompatible features used in that query.

1. Queries with suggested repairs &mdash; Provides two rows per query. The first row contains the original query and the second row contains the modified query. The incompatible feature that is repaired in the modified query is also provided.

## Troubleshooting

The EDB SQL Assess tool generates a log file in the same path where the report is generated. The path is provided by the user in the command line options. The tool supports three log levels. If set to OFF then log is not generated. If set to INFO, which is the default, then all messages are logged except the queries that are assessed. If the level is set to FINE then the queries that are assessed are also logged in the file.
